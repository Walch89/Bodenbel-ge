<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/1.7.2/aframe/build/aframe-ar.min.js"></script>
    <script src="https://hammerjs.github.io/dist/hammer.min.js"></script>
  </head>
  
  <body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;"
             vr-mode-ui="enabled: false" 
             renderer="logarithmicDepthBuffer: true; precision: medium;">
      
      <a-assets>
        <img id="boden-textur" src="" crossorigin="anonymous">
      </a-assets>

      <!-- Interaktive BodenflÃ¤che -->
      <a-plane id="boden" src="#boden-textur" 
               position="0 0 0" rotation="-90 0 0" 
               width="5" height="5" 
               gesture-handler shadow>
      </a-plane>
      
      <a-marker-camera preset="hiro"></a-marker-camera>
    </a-scene>

    <script>
      // ðŸ”¹ Korrekte URL fÃ¼r Bilder (GitHub-kompatibel)
      function getRawGitHubURL(url) {
          return url.replace("github.com", "raw.githubusercontent.com").replace("/blob/", "/");
      }

      // ðŸ”¹ URL-Parameter auslesen (z. B. ?boden=parkett)
      function getQueryVariable(variable) {
          var query = window.location.search.substring(1);
          var vars = query.split("&");
          for (var i = 0; i < vars.length; i++) {
              var pair = vars[i].split("=");
              if (pair[0] === variable) {
                  return decodeURIComponent(pair[1]);
              }
          }
          return null;
      }

      // ðŸ”¹ VerfÃ¼gbare BodenbelÃ¤ge (GitHub RAW Links verwenden!)
      var bodenTyp = getQueryVariable("boden");
      var bodenBilder = {
          "parkett": getRawGitHubURL("https://i.imgur.com/avqSYp3.jpg"),
          "fliesen": getRawGitHubURL("https://i.imgur.com/avqSYp3.jpg"),
          "vinyl": getRawGitHubURL("https://i.imgur.com/avqSYp3.jpg")
      };

      // ðŸ”¹ Standardbild, falls kein Boden-Typ angegeben wurde
      var bodenBild = bodenBilder[bodenTyp] || getRawGitHubURL("https://i.imgur.com/avqSYp3.jpg");

      // ðŸ”¹ Bild setzen & sichtbar machen
      var bodenPlane = document.getElementById("boden");
      var bodenTextur = document.getElementById("boden-textur");

      bodenTextur.onload = function() {
          bodenPlane.setAttribute("material", "src: #boden-textur");
      };
      bodenTextur.setAttribute("src", bodenBild);
    </script>

    <!-- ðŸ”¹ Verbesserte Drag-&-Pinch-Steuerung -->
    <script>
      AFRAME.registerComponent('gesture-handler', {
        init: function () {
          var el = this.el;
          var hammer = new Hammer(el.sceneEl.canvas);

          hammer.get('pinch').set({ enable: true });
          hammer.get('pan').set({ direction: Hammer.DIRECTION_ALL });

          var scale = 1;
          var position = el.getAttribute("position");

          // âœ… Y-Koordinate bleibt auf 0 (keine HÃ¶henabweichung mehr)
          position.y = 0;

          hammer.on("pinchmove", function (evt) {
            scale = Math.max(0.5, Math.min(3, scale * evt.scale));
            el.setAttribute("scale", { x: scale, y: scale, z: scale });
          });

          hammer.on("panmove", function (evt) {
            position.x += evt.deltaX * 0.0005;
            position.z += evt.deltaY * 0.0005;
            el.setAttribute("position", position);
          });
        }
      });
    </script>

  </body>
</html>
